name: Test Registration Form

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm init -y
          npm install @playwright/test
          npx playwright install

      - name: Run tests
        run: |
          mkdir -p tests
          cat > tests/registration.spec.js << 'EOF'
          const { test, expect } = require('@playwright/test');

          test.describe('Registration Form Tests', () => {
            let page;
            
            test.beforeEach(async ({ browser }) => {
              page = await browser.newPage();
              await page.goto('file://' + process.cwd() + '/index.html');
            });

            test('Form should load successfully', async () => {
              await expect(page).toHaveTitle('User Registration Portal');
              await expect(page.locator('#firstName')).toBeVisible();
            });

            test('Invalid email should show error', async () => {
              await page.locator('#email').fill('invalid-email');
              await page.locator('button[type="submit"]').click();
              await expect(page.locator('#email')).toHaveClass(/is-invalid/);
            });
          });
          EOF
          
          npx playwright test

      - name: Upload test results
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: playwright-report/